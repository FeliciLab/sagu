<?php
/**
 * <--- Copyright 2005-2010 de Solis - Cooperativa de Solues Livres Ltda.
 *
 * Este arquivo  parte do programa Sagu.
 *
 * O Sagu  um software livre; voc pode redistribu-lo e/ou modific-lo
 * dentro dos termos da Licena Pblica Geral GNU como publicada pela Fundao
 * do Software Livre (FSF); na verso 2 da Licena.
 *
 * Este programa  distribudo na esperana que possa ser til, mas SEM
 * NENHUMA GARANTIA; sem uma garantia implcita de ADEQUAO a qualquer MERCADO
 * ou APLICAO EM PARTICULAR. Veja a Licena Pblica Geral GNU/GPL em
 * portugus para maiores detalhes.
 *
 * Voc deve ter recebido uma cpia da Licena Pblica Geral GNU, sob o ttulo
 * "LICENCA.txt", junto com este programa, se no, acesse o Portal do Software
 * Pblico Brasileiro no endereo www.softwarepublico.gov.br ou escreva para a
 * Fundao do Software Livre (FSF) Inc., 51 Franklin St, Fifth Floor, Boston,
 * MA 02110-1301, USA --->
 *
 * Passo responsavel pelo detalhamento da nfase
 *
 * @author Moises Heberle [moises@solis.coop.br]
 *
 * @version $Id$
 *
 * \b Maintainers: \n
 * Moises Heberle [moises@solis.coop.br]
 *
 * @since
 * Class created on 21/02/2011
 *
 **/

class FrmStageDetailsTrainingDetail extends FrmStageDetails
{
    //Utilizado em outro formulario (FrmStageDetailsEdit)
    public $subdetail;

    public function __construct($steps = null)
    {
        parent::__construct(null, $steps, __CLASS__);
    }

    
    public function createFields()
    {
        $MIOLO = MIOLO::getInstance();
        $module = SAGU::getFileModule(__FILE__);
        $action = MIOLO::getCurrentAction();
        $function = MIOLO::_REQUEST('function');

        //Load data
        $allData = $this->getStepData();
        $stepData = $this->getStepDataByForm(__CLASS__);

        if ( $this->isFirstAccess() )
        {
        }

        $fields = $this->getFields();

        $this->setFields($fields);
//        $this->setValidators($validators);
    }


    public function getFields()
    {
        $MIOLO = MIOLO::getInstance();
        $module = SAGU::getFileModule(__FILE__);
        $action = MIOLO::getCurrentAction();
        $function = MIOLO::_REQUEST('function');

        $busTrainingEmphasis = new BusinessAcademicBusTrainingEmphasis();
        
        $fields[] = new MDiv('divLimbo');

        //Enfase
        $trainingEmphasisIdLabel  = new MText('trainingEmphasisIdLabel', _M('nfase', $module) . ':');
        $trainingEmphasisIdLabel->setWidth(SAGU::getParameter('BASIC', 'FIELD_CONTAINER_SIZE'));
        $trainingEmphasisIdLabel->setClass('m-caption m-caption-required');
        $trainingEmphasisId = new MSelection('trainingEmphasisId', null, '',  $busTrainingEmphasis->listTrainingEmphasis());
        $trainingEmphasisId->addAttribute('onchange', $this->getAjaxAction('fillInformation', 'divLimbo', false));
        $_fields[] = new MHContainer('trainingEmphasisIdCnt', array($trainingEmphasisIdLabel, $trainingEmphasisId));
        $_validators[] = new MIntegerValidator('trainingEmphasisId', _M('nfase', $module), 'required');

        //Field responsible
        $responsibleLabel = new MText('responsibleLabel', _M('Responsvel',$module).':');
        $responsibleLabel->setWidth(SAGU::getParameter('BASIC', 'FIELD_CONTAINER_SIZE'));
        $responsibleLabel->setClass('m-caption m-caption-required');
        $responsibleId = new MLookupTextField('responsibleId', $this->getFormValue('responsibleId',$data->responsibleId), '', SAGU::getParameter('BASIC', 'FIELD_ID_SIZE'), null, null, 'responsibleName', 'basic', 'PhysicalPerson', null, null, true);
        $responsibleId->setJsHint(_M('Informe o cdigo do responsvel',$module));
        $_validators[] = new MIntegerValidator('responsibleId', _M('Responsvel', $module), 'required');
        //Field responsible name
        $responsibleName = new MTextField('responsibleName', $this->responsibleName->value, '', SAGU::getParameter('BASIC', 'FIELD_DESCRIPTION_SIZE'),null,null, true);
        $responsibleName->setJsHint(_M('Nome da pessoa',$module));
        $hctResponsible = new MHContainer('hctResponsible', array($responsibleLabel, $responsibleId,$responsibleName));
        $hctResponsible->setShowLabel(true);
        $_fields[] = $hctResponsible;


        //Local
        $placeLabel = new MText('placeLabel', _M('Local', $module) . ':');
        $placeLabel->setWidth(SAGU::getParameter('BASIC', 'FIELD_CONTAINER_SIZE'));
        $placeLabel->setClass('m-caption m-caption-required');
        $place = new MTextField('place', null, null, SAGU::getParameter('BASIC', 'FIELD_DESCRIPTION_SIZE'));
        $place->setJsHint(_M('Informe o local', $module));
        $_validators[] = new MRequiredValidator('place', _M('Local', $module));
        $_fields[] = new MHContainer('placeCnt', array($placeLabel, $place));

        //Atividades realizadas
        $realizedActivitiesLabel = new MText('realizedActivitiesLabel', _M('Atividades realizadas', $module) . ':');
        $realizedActivitiesLabel->setWidth(SAGU::getParameter('BASIC', 'FIELD_CONTAINER_SIZE'));
        $realizedActivitiesLabel->setClass('m-caption m-caption-required');
        $realizedActivities = new MMultiLineField('realizedActivities', null, null, 100, 6, 45);
        $realizedActivities->setJsHint(_M('Informe as atividades realizadas', $module));
        $_validators[] = new MRequiredValidator('realizedActivities', _M('Atividades realizadas', $module));
        $_fields[] = new MHContainer('realizedActivitiesCnt', array($realizedActivitiesLabel, $realizedActivities));

        //Data de inicio
        $startDateLabel = new MText('startDateLabel', _M('Data de incio', $module) . ':');
        $startDateLabel->setWidth( SAGU::getParameter('BASIC', 'FIELD_CONTAINER_SIZE') );
        $startDateLabel->setClass('m-caption m-caption-required');
        $startDate = new MCalendarField('startDate', null, null, SAGU::getParameter('BASIC', 'FIELD_DATE_SIZE'));
        $startDate->setJsHint(_M('Informe a data de incio', $module));
        $_validators[] = new MDateDMYValidator('startDate', _M('Data de incio', $module), 'required');
        $_fields[] = new MHContainer('startDateCnt', array($startDateLabel, $startDate));

        //Data de fim
        $endDateLabel = new MText('endDateLabel', _M('Data de fim', $module) . ':');
        $endDateLabel->setWidth( SAGU::getParameter('BASIC', 'FIELD_CONTAINER_SIZE') );
        $endDateLabel->setClass('m-caption m-caption-required');
        $endDate = new MCalendarField('endDate', null, null, SAGU::getParameter('BASIC', 'FIELD_DATE_SIZE'));
        $endDate->setJsHint(_M('Informe a data de fim', $module));
        $_validators[] = new MDateDMYValidator('endDate', _M('Data de fim', $module), 'required');
        $_fields[] = new MHContainer('endDateCnt', array($endDateLabel, $endDate));

        //Carga horaria
        $durationLabel = new MText('endDateLabel', _M('Carga horria', $module) . ':');
        $durationLabel->setWidth( SAGU::getParameter('BASIC', 'FIELD_CONTAINER_SIZE') );
        $durationLabel->setClass('m-caption m-caption-required');
        $duration = new MTextField('duration', null, null, SAGU::getParameter('BASIC', 'FIELD_TIME_SIZE'), 'hh:mm');
        $duration->setJsHint(_M('Informe a durao do estgio, em horas.', $module));
        $_validators[] = new MFloatValidator('duration', _M('Carga horria', $module), 'required');
        $_fields[] = new MHContainer('durationCnt', array($durationLabel, $duration));

        $_cols[] = new MGridColumn(null, 'left', true, '', false, 'physicalResourceId');
        $_cols[] = new MGridColumn(_M('nfase', $module), 'left', true, '', true, 'trainingEmphasisId', null, $busTrainingEmphasis->listTrainingEmphasis('ASSOCIATIVE'));
        $_cols[] = new MGridColumn(null, 'left', true, '', false, 'responsibleId');
        $_cols[] = new MGridColumn(_M('Responsvel', $module), 'left', true, '', true, 'responsibleName');
        $_cols[] = new MGridColumn(_M('Local', $module), 'left', true, '', true, 'place');
        $_cols[] = new MGridColumn(_M('Atividades realizadas', $module), 'left', true, '', true, 'realizedActivities');
        $_cols[] = new MGridColumn(_M('Data de incio', $module), 'left', true, '', true, 'startDate');
        $_cols[] = new MGridColumn(_M('Data de fim', $module), 'left', true, '', true, 'endDate');
        $_cols[] = new MGridColumn(_M('Carga horria', $module), 'left', true, '', true, 'duration');

        $fields[] = $sub = $this->subdetail = new MSubDetail('emphasis', _M('nfases', $module), $_cols);
        $sub->setFields($_fields);
        $sub->setValidators($_validators);
        if ( count($stepData->emphasis) > 0 )
        {
            $sub->setData( $stepData->emphasis );
        }

        return $fields;
    }


    public function fillInformation($args)
    {
        $MIOLO = MIOLO::getInstance();
        $module = SAGU::getFileModule(__FILE__);
        $busTrainingEmphasis = new BusinessAcademicBusTrainingEmphasis();

        if ( strlen($args->trainingEmphasisId) > 0 )
        {
            $row = $busTrainingEmphasis->getTrainingEmphasis($args->trainingEmphasisId);
            $MIOLO->page->addAjaxJsCode("
            xGetElementById('responsibleId').value = '{$row->responsibleId}';
            xGetElementById('place').value = '{$row->place}';
        ");
        }

        return '';
    }
}
?>