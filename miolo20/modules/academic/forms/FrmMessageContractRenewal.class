<?php
/**
 * <--- Copyright 2005-2010 de Solis - Cooperativa de Solues Livres Ltda.
 *
 * Este arquivo  parte do programa Sagu.
 *
 * O Sagu  um software livre; voc pode redistribu-lo e/ou modific-lo
 * dentro dos termos da Licena Pblica Geral GNU como publicada pela Fundao
 * do Software Livre (FSF); na verso 2 da Licena.
 *
 * Este programa  distribudo na esperana que possa ser til, mas SEM
 * NENHUMA GARANTIA; sem uma garantia implcita de ADEQUAO a qualquer MERCADO
 * ou APLICAO EM PARTICULAR. Veja a Licena Pblica Geral GNU/GPL em
 * portugus para maiores detalhes.
 *
 * Voc deve ter recebido uma cpia da Licena Pblica Geral GNU, sob o ttulo
 * "LICENCA.txt", junto com este programa, se no, acesse o Portal do Software
 * Pblico Brasileiro no endereo www.softwarepublico.gov.br ou escreva para a
 * Fundao do Software Livre (FSF) Inc., 51 Franklin St, Fifth Floor, Boston,
 * MA 02110-1301, USA --->
 *
 * Form to manipulate acdMessageContractRenewal table records
 *
 * @author Alexandre Heitor Schmidt [alexsmith@solis.coop.br]
 *
 * @version $Id$
 *
 * \b Maintainers: \n
 * Alexandre Heitor Schmidt [alexsmith@solis.coop.br]
 * Arthur Lehdermann [arthur@solis.coop.br]
 * Daniel Afonso Heisler [daniel@solis.coop.br]
 * Jamiel Spezia [jamiel@solis.coop.br]
 * Moises Heberle [moises@solis.coop.br]
 * Samuel Koch [samuel@solis.coop.br]
 * William Prigol Lopes [william@solis.coop.br]
 *
 * @since
 * Class created on 21/09/2005
 */
class FrmMessageContractRenewal extends SManagementForm
{
    public function __construct()
    {
        parent::__construct(new AcdMessageContractRenewal(), array('messageContractRenewalId'), 'BusMessageContractRenewal');
    }

    public function defineFields()
    {
        $MIOLO    = MIOLO::getInstance();
        $module   = MIOLO::getCurrentModule();
        $action   = MIOLO::getCurrentAction();
        $function = MIOLO::_REQUEST('function');

        if ( in_array($function, array(SForm::FUNCTION_UPDATE, SForm::FUNCTION_DELETE )) )
        {
            $messageContractRenewalId = MIOLO::_REQUEST('messageContractRenewalId');

            $fields[] = new MTextLabel('messageContractRenewalId', $messageContractRenewalId, _M('Cdigo',$module));
            $fields[] = new MHiddenField('messageContractRenewalId', $messageContractRenewalId);

            $data = $this->busObject->getMessageContractRenewal($messageContractRenewalId);
        }

        /*
         * Course occurrence lookup
         */
        $lkpValue = array(
            $this->GetFormValue('courseId', $data->courseId),
            $this->GetFormValue('courseVersion', $data->courseVersion),
            $this->GetFormValue('turnId', $data->turnId),
            $this->GetFormValue('unitId', $data->unitId)
        );
        $courseOccurrenceLookup = new SCourseOccurrenceLookup($lkpValue);
        $fields[] = $courseOccurrenceLookup;

        if ( in_array($function, array(SForm::FUNCTION_UPDATE, SForm::FUNCTION_DELETE)) )
        {
            $lookupFilters = array('courseId'=>'courseId', 'courseVersion'=>'courseVersion', 'turnId'=>'turnId', 'unitId'=>'unitId');
        }
        else
        {
            $businessPeriod = new BusinessAcademicBusPeriod();
            $periodId = new MComboBox('periodId', strlen($this->getFormValue('periodId', $data->periodId))>0 ? $this->getFormValue('periodId', $data->periodId) : SAGU::getParameter('BASIC', 'CURRENT_PERIOD_ID'), _M('Perodo',$module), $businessPeriod->listPeriod(), true );
            $periodId->setJsHint(_M('Selecione um perodo', $module));
            $fields[] = $periodId;

            $lookupFilters = array('courseId'=>'courseId', 'courseVersion'=>'courseVersion', 'turnId'=>'turnId', 'unitId'=>'unitId', 'periodId' => 'periodId');
        }

        $learningPeriodLabel = new MText('learningPeriodLabel', _M('Perodo letivo',$module) . ':');
        $learningPeriodLabel->setWidth(SAGU::getParameter('BASIC', 'FIELD_CONTAINER_SIZE'));
        $learningPeriodLabel->setClass('m-caption m-caption-required');
        $learningPeriodId = new MLookupTextField('learningPeriodId', $this->getFormValue('learningPeriodId', $data->learningPeriodId), '', SAGU::getParameter('BASIC', 'FIELD_LOOKUPFIELD_SIZE'), null, null,'limbo, courseId, courseVersion, turnId, unitId, learningPeriodDescription, limbo, limbo, limbo, limbo, limbo, limbo, limbo, limbo, limbo, limbo, courseName, turnDescription, unitDescription', $module, 'LearningPeriod', null, $lookupFilters, true);
        $learningPeriodId->setJsHint(_M('Informe o cdigo do perodo letivo', $module));
        $validators[] = new MRequiredValidator('learningPeriodId', _M('Perodo letivo',$module));
        $learningPeriodDescription = new MTextField('learningPeriodDescription', $this->getFormValue('learningPeriodDescription', $data->learningPeriodDescription), '', SAGU::getParameter('BASIC', 'FIELD_DESCRIPTION_SIZE'));
        $learningPeriodDescription->setReadOnly(true);
        $learningPeriodDescription->setJsHint(_M('Descrio', $module));
        $hctLearningPeriod = new MHContainer('hctLearningPeriod', array($learningPeriodLabel, $learningPeriodId, $learningPeriodDescription));
        $fields[]  = $hctLearningPeriod;

        $message = new MMultiLineField('message', $this->getFormValue('message', $data->message), _M('Mensagem', $module), 100, 5, 40);
        $message->setJsHint(_M('Informe a mensagem', $module));
        $validators[] = new MRequiredValidator('message');
        $fields[] = $message;

        $opts = array(
            'D' => _M('Padro',$module),
            'B' => _M('Negrito',$module),
            'I' => _M('Itlico',$module)
        );

        $font = new MSelection('font', $this->getFormValue('font', $data->font), _M('Fonte',$module), $opts);
        $font->setJsHint(_M('Informe a fonte', $module));
        $validators[] = new MRequiredValidator('font');
        $fields[] = $font;

        $opts = array (
            '1'  => _M('Um',$module),
            '2'  => _M('Dois',$module),
            '3'  => _M('Trs',$module),
            '4'  => _M('Quatro',$module),
            '5'  => _M('Cinco',$module),
            '6'  => _M('Seis',$module),
            '7'  => _M('Sete',$module),
            '8'  => _M('Oito',$module),
            '9'  => _M('Nove',$module),
            '10' => _M('Dez',$module)
        );

        $sequence = new MSelection('sequence', $this->getFormValue('sequence', $data->sequence), _M('Sequncia',$module), $opts);
        $sequence->setJsHint(_M('Informe a sequncia', $module));
        $validators[] = new MRequiredValidator('sequence');
        $fields[] = $sequence;

        $length = $this->getFormValue('length', $data->length);
        $length = new MTextField('length', $length ? $length : SAGU::getParameter('ACADEMIC', 'DEFAULT_LINE_CHARS'), _M('Caracteres por linha',$module), 5);
        $length->setJsHint(_M('Informe o nmero de caracteres por linha', $module));
        $validators[] = new MRequiredValidator('length', _M('Caracteres por linha',$module), 'required');
        $fields[] = $length;

        $isListenerLabel = new MText('isListenerLabel', _M('Exibida para alunos ouvintes',$module) . '?');
        $isListenerLabel->setWidth(SAGU::getParameter('BASIC', 'FIELD_CONTAINER_SIZE'));
        $isListenerLabel->setClass('m-caption m-caption-required');
        $isListener = strlen($this->GetFormValue('isListener',$data->isListener)) > 0 ? $this->GetFormValue('isListener',$data->isListener) : DB_FALSE;
        $isListener = new MRadioButtonGroup('isListener', '', SAGU::listTrueFalse(1), $isListener, null, 'horizontal');
        $isListener->SetShowLabel(false);
        $hctIsListener = new MHContainer('hctIsListener', array($isListenerLabel, $isListener));
        $fields[]  = $hctIsListener;

        $status = new MSelection('status', $this->getFormValue('status', $data->status), _M('Exibir para',$module), $this->busObject->listStatus());
        $status->setJsHint(_M('Para qual tipo de aluno esta mensagem ser mostrada?', $module));
        $validators[] = new MRequiredValidator('status');
        $fields[] = $status;

        parent::defineFields($fields, $validators, $data);
    }
}
?>