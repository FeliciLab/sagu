<?php
/**
 * <--- Copyright 2005-2010 de Solis - Cooperativa de Solues Livres Ltda.
 *
 * Este arquivo  parte do programa Sagu.
 *
 * O Sagu  um software livre; voc pode redistribu-lo e/ou modific-lo
 * dentro dos termos da Licena Pblica Geral GNU como publicada pela Fundao
 * do Software Livre (FSF); na verso 2 da Licena.
 *
 * Este programa  distribudo na esperana que possa ser til, mas SEM
 * NENHUMA GARANTIA; sem uma garantia implcita de ADEQUAO a qualquer MERCADO
 * ou APLICAO EM PARTICULAR. Veja a Licena Pblica Geral GNU/GPL em
 * portugus para maiores detalhes.
 *
 * Voc deve ter recebido uma cpia da Licena Pblica Geral GNU, sob o ttulo
 * "LICENCA.txt", junto com este programa, se no, acesse o Portal do Software
 * Pblico Brasileiro no endereo www.softwarepublico.gov.br ou escreva para a
 * Fundao do Software Livre (FSF) Inc., 51 Franklin St, Fifth Floor, Boston,
 * MA 02110-1301, USA --->
 *
 * @author Moises Heberle [moises@solis.coop.br]
 *
 * $version: $Id$
 *
 * \b Maintainers \n
 * Arthur Lehdermann [arthur@solis.coop.br]
 * Moises Heberle [moises@solis.coop.br]
 *
 * @since
 * Class created on 14/06/2011
 */
class FrmRealizedActivitySearch extends SSearchForm
{
    public function __construct($data)
    {
        parent::__construct(null, new HurRealizedActivity(), array('realizedActivityId'));
    }

    public function defineFields()
    {
        $MIOLO = MIOLO::getInstance();
        $module = SAGU::getFileModule(__FILE__);
        $action = MIOLO::getCurrentAction();

        $fields[] = new MTextField('realizedActivityIdS', $this->getRequestValue('realizedActivityIdS'), _M('Cdigo', $module), 10);

        // Atividade programada
        $fields[] = $lkp = new SLookupContainer('scheduledActivityIdS', $this->getRequestValue('scheduledActivityIdS'), array(
            'module' => $module,
            'item' => 'ScheduledActivity',
            'label' => _M('Atividade programada', $module),
            'hint' => _M('Informe a atividade programada', $module),
        ));

        // Data inicial/final
        $opts = array(
            'baseGroup' => false,
            'type' => 'timestamp',
            'begin' => array('label' => _M('Data inicial', $module), 'dateId' => 'startDateS', 'timeId' => 'startTimeS'),
            'end' => array('label' => _M('Data final', $module), 'dateId' => 'endDateS', 'timeId' => 'endTimeS'),
        );
        $fields[] = new SBeginEndPeriod($opts);
        $validators[] = new MDateDMYValidator('startDateS', _M('Data inicial', $module));
        $validators[] = new MDateDMYValidator('endDateS', _M('Data final', $module));
        $validators[] = new MTIMEValidator('startTimeS', _M('Hora de incio', $module));
        $validators[] = new MTIMEValidator('endTimeS', _M('Hora de fim', $module));

        $opts = array(
            'baseGroup' => false,
            'type' => 'timestamp',
            'begin' => array('label' => _M('Data de cancelamento', $module), 'dateId' => 'cancelDateS', 'timeId' => 'cancelTimeS'),
            'end' => array('enable' => false),
        );
        $fields[] = new SBeginEndPeriod($opts);
        $validators[] = new MDateDMYValidator('cancelDateS', _M('Data de cancelamento', $module));
        $validators[] = new MTIMEValidator('cancelTimeS', _M('Hora de cancelamento', $module));

        // Tipo
        $fields[] = new MSelection('activityTypeIdS', $this->getRequestValue('activityTypeIdS'), _M('Tipo de atividade', $module), HurActivityType::listRecords());

        // Descricao
        $fields[] = new MTextField('descriptionS', $this->getRequestValue('description'), _M('Descrio', $module), SAGU::getParameter('BASIC', 'FIELD_DESCRIPTION_SIZE'));// Descricao

        // Local
        $fields[] = new MTextField('locationS', $this->getRequestValue('location'), _M('Local', $module), SAGU::getParameter('BASIC', 'FIELD_DESCRIPTION_SIZE'));

        // Interno
        $isInternalLabelS = new MText('isInternalLabelS', _M(' interno', $module) . '?');
        $isInternalLabelS->setWidth(SAGU::getParameter('BASIC', 'FIELD_CONTAINER_SIZE'));
        $isInternalS = new MRadioButtonGroup('isInternalS', null, SAGU::listTrueFalseIndifferent(1), $data->isInternal, null, 'horizontal');
        $hctIsInternal = new MHContainer('hctIsInternalS', array( $isInternalLabelS, $isInternalS ));
        $hctIsInternal->setShowLabel(false);
        $fields[] = $hctIsInternal;

        $validators[] = new MIntegerValidator('realizedActivityIdS', _M('Cdigo', $module), 'optional');
        $validators[] = new MIntegerValidator('scheduledActivityIdS', _M('Atividade programada', $module), 'optional');
        $validators[] = new MIntegerValidator('activityTypeIdS', _M('Tipo de atividade', $module), 'optional');

        parent::defineFields($fields, $module, 'GrdRealizedActivitySearch', $validators);
    }

    public function getTypesData()
    {
        $data = parent::getTypesData();
        if ( strlen($data->startDate) > 0 )
        {
            $data->startDate = trim($data->startDate . ' ' . $this->getRequestValue('startTimeS'));
        }
        if ( strlen($data->endDate) > 0 )
        {
            $data->endDate = trim($data->endDate . ' ' . $this->getRequestValue('endTimeS'));
        }
        if ( strlen($data->cancelDate) > 0 )
        {
            $data->cancelDate = trim($data->cancelDate . ' ' . $this->getRequestValue('cancelTimeS'));
        }

        return $data;
    }
}
?>